<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Imbalance Monitor</title>
    <style>
        body {
            font-family: sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 2rem;
            transition: background 0.3s, color 0.3s;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 1rem;
            background: var(--table-bg);
            color: var(--text);
        }
        th, td {
            border: 1px solid #888;
            padding: 8px;
        }
        th {
            background: var(--header-bg);
        }
        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        button {
            padding: 8px 12px;
            font-size: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h1>üìä Imbalance Monitor</h1>
        <div>
            <button onclick="loadAll()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ –≤—Ä—É—á–Ω—É</button>
            <button onclick="toggleTheme()">üåì –ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É</button>
        </div>
    </div>
    <h2>Buy Imbalance</h2>
    <div id="buy">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    <h2>Sell Imbalance</h2>
    <div id="sell">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <script>
        let theme = localStorage.getItem("theme") || "light";

        function applyTheme() {
            if (theme === "dark") {
                document.documentElement.style.setProperty('--bg', '#111');
                document.documentElement.style.setProperty('--text', '#fff');
                document.documentElement.style.setProperty('--table-bg', '#222');
                document.documentElement.style.setProperty('--header-bg', '#333');
            } else {
                document.documentElement.style.setProperty('--bg', '#f4f4f4');
                document.documentElement.style.setProperty('--text', '#000');
                document.documentElement.style.setProperty('--table-bg', '#fff');
                document.documentElement.style.setProperty('--header-bg', '#eee');
            }
        }

        function toggleTheme() {
            theme = (theme === "dark") ? "light" : "dark";
            localStorage.setItem("theme", theme);
            applyTheme();
        }

        async function loadTable(json, id) {
            const res = await fetch(json + '?t=' + new Date().getTime());
            const data = await res.json();
            const container = document.getElementById(id);
            if (data.length === 0) {
                container.innerText = "–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö";
                return;
            }
            let html = "<table><thead><tr>";
            data[0].forEach(cell => html += `<th>${cell}</th>`);
            html += "</tr></thead><tbody>";
            data.slice(1).forEach(row => {
                html += "<tr>";
                row.forEach(cell => html += `<td>${cell}</td>`);
                html += "</tr>";
            });
            html += "</tbody></table>";
            container.innerHTML = html;
        }

        function loadAll() {
            loadTable("buy_data.json", "buy");
            loadTable("sell_data.json", "sell");
        }

        applyTheme();
        loadAll();
        setInterval(loadAll, 30000);
    </script>
</body>
</html>